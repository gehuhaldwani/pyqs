---
import FunctionRow from "@/components/explorer/FunctionRow.astro";
import FileList from "@/components/explorer/FileList.astro";
import Base from "@/layouts/Base.astro";
import type { Entry, Props } from "@/utils/types.ts";
import { toTitleCase } from "@/utils/helpers";

const { title, path, parent_path, entries } = Astro.props;

const dirs: Entry[] = entries.filter((entry) => entry.type === "dir");
const pdfs: Entry[] = entries.filter((entry) => entry.type === "pdf");
const urls: Entry[] = entries.filter((entry) => entry.type === "url");
const files: Entry[] = entries.filter((entry) => entry.type === "file");

const speculationRules = `
<script type="speculationrules">
    {
        "prefetch": [
            {
                "source": "list",
                "urls": [${dirs.map((dir: Entry) => `"${dir.path}"`)}${pdfs.length !== 0 ? "," : ""} ${pdfs.map((pdf: Entry) => `"${pdf.path}"`)}]
            }
        ]
    }
</script>`;

const description = path.split("/").slice(1).join(" > ");
---

<Base title={toTitleCase(title)} description={description}>
	<Fragment set:html={speculationRules} />
	<FunctionRow path={path} parent_path={parent_path} />
	<FileList title={title} dirs={dirs} pdfs={pdfs} urls={urls} files={files} />
</Base>

<style is:global>
	:root {
		--text-color: #242424;
		--highlight-color: #f7f7f7;
		--highlight-hover-color: #f0f0f0;
		--box-shadow: 0rem 0.125rem 0.375rem rgba(0, 0, 0, 0.1),
			0rem 0.5rem 1rem rgba(0, 0, 0, 0.08);
	}

	.dark {
		--text-color: white;
		--highlight-color: #2d2d2d;
		--highlight-hover-color: #333333;
		--box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
	}
</style>
