---
import FunctionRow from "@/components/explorer/FunctionRow.astro";
import FileList from "@/components/explorer/FileList.astro";
import Base from "@/layouts/Base.astro";
import { toTitleCase } from "@/utils/helpers";
import type { Entry } from "@/utils/types";

interface Props {
	entry: Entry;
}

const { entry } = Astro.props;

const dirs: Entry[] = entry.entries.filter(
	(entry: Entry) => entry.type === "dir",
);
const pdfs: Entry[] = entry.entries.filter(
	(entry: Entry) => entry.type === "pdf",
);
const urls: Entry[] = entry.entries.filter(
	(entry: Entry) => entry.type === "url",
);
const files: Entry[] = entry.entries.filter(
	(entry: Entry) => entry.type === "file",
);

const speculationRules = `
<script type="speculationrules">
    {
        "prefetch": [
            {
                "source": "list",
                "urls": [${dirs.map((dir: Entry) => `"${dir.path}"`)}${pdfs.length !== 0 ? "," : ""} ${pdfs.map((pdf: Entry) => `"${pdf.path}"`)}]
            }
        ]
    }
</script>`;

const pathList = entry.path.split("/").slice(1);
const description = pathList.join(" > ");

let pageTitle: string = entry.title;

if (entry.title.toLowerCase() === "others") {
	pageTitle = pathList.splice(-3).join(" > ");
}
if (
	entry.title.toLowerCase() === "mid" ||
	entry.title.toLowerCase() === "end"
) {
	pageTitle = pathList.splice(-3).join(" > ");
}
if (entry.title.toLowerCase() === "old") {
	pageTitle = pathList.splice(-4).join(" > ");
}
---

<Base title={toTitleCase(pageTitle)} description={description}>
	<Fragment set:html={speculationRules} />
	<FunctionRow path={entry.path} parent_path={entry.parent_path} />
	<FileList
		path={entry.path}
		title={entry.title}
		dirs={dirs}
		pdfs={pdfs}
		urls={urls}
		files={files}
	/>
</Base>

<style is:global>
	:root {
		--text-color: #242424;
		--highlight-color: #f7f7f7;
		--highlight-hover-color: #f0f0f0;
		--box-shadow: 0rem 0.125rem 0.375rem rgba(0, 0, 0, 0.1),
			0rem 0.5rem 1rem rgba(0, 0, 0, 0.08);
	}

	.dark {
		--text-color: white;
		--highlight-color: #2d2d2d;
		--highlight-hover-color: #333333;
		--box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
	}
</style>
