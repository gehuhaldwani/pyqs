---
import Head, { type Props } from "@/components/partials/Head.astro";
import "@/styles/starwind.css";
import "@/styles/globals.css";
---

<script is:inline>
	function setDarkMode() {
		const getThemePreference = () => {
			if (
				typeof localStorage !== "undefined" &&
				localStorage.getItem("theme")
			) {
				return localStorage.getItem("theme");
			}
			return window.matchMedia("(prefers-color-scheme: dark)").matches
				? "dark"
				: "light";
		};
		const isDark = getThemePreference() === "dark";
		document.documentElement.classList[isDark ? "add" : "remove"]("dark");

		if (typeof localStorage !== "undefined") {
			const observer = new MutationObserver(() => {
				const isDark =
					document.documentElement.classList.contains("dark");
				localStorage.setItem("theme", isDark ? "dark" : "light");
			});
			observer.observe(document.documentElement, {
				attributes: true,
				attributeFilter: ["class"],
			});
		}
	}

	// Runs on initial navigation
	setDarkMode();

	// Runs on view transitions navigation
	document.addEventListener("astro:after-swap", setDarkMode);
</script>

<html lang="en">
	<head>
		<Head {...Astro.props} />
	</head>
	<body class="min-h-screen">
		<slot />
	</body>
</html>
