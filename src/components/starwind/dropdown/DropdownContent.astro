---
import type { HTMLAttributes } from "astro/types";
import { tv } from "tailwind-variants";

type Props = HTMLAttributes<"div"> & {
  /**
   * Side of the dropdown
   * @default bottom
   */
  side?: "top" | "bottom" | "left" | "right";
  /**
   * Alignment of the dropdown
   * @default start
   */
  align?: "start" | "center" | "end";
  /**
   * Offset distance in pixels
   * @default 4
   */
  sideOffset?: number;
  /**
   * Open and close animation duration in milliseconds
   * @default 150
   */
  animationDuration?: number;
};

export const dropdownContent = tv({
  base: [
    "starwind-dropdown-content",
    "bg-popover text-popover-foreground z-50 min-w-[9rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
    "data-[state=open]:animate-in fade-in zoom-in-95",
    "data-[state=closed]:animate-out data-[state=closed]:fill-mode-forwards fade-out zoom-out-95",
    "absolute will-change-transform",
  ],
  variants: {
    side: {
      bottom: "slide-in-from-top-2 slide-out-to-top-2 top-full",
      top: "slide-in-from-bottom-2 slide-out-to-bottom-2 bottom-full",
      right: "slide-in-from-left-2 slide-out-to-left-2 top-0 left-full",
      left: "slide-in-from-right-2 slide-out-to-right-2 top-0 right-full",
    },
    align: {
      start: "",
      center: "",
      end: "",
    },
  },
  compoundVariants: [
    {
      side: ["top", "bottom"],
      align: "start",
      class: "slide-in-from-left-1 slide-out-to-left-1 left-0",
    },
    {
      side: ["top", "bottom"],
      align: "center",
      class: "left-1/2 -translate-x-1/2",
    },
    {
      side: ["top", "bottom"],
      align: "end",
      class: "slide-in-from-right-1 slide-out-to-right-1 right-0",
    },
    {
      side: ["left", "right"],
      align: "start",
      class: "top-0",
    },
    {
      side: ["left", "right"],
      align: "center",
      class: "top-1/2 -translate-y-1/2",
    },
    {
      side: ["left", "right"],
      align: "end",
      class: "bottom-0",
    },
  ],
  defaultVariants: {
    side: "bottom",
    align: "start",
  },
});

const {
  class: className,
  side = "bottom",
  align = "start",
  sideOffset = 4,
  animationDuration = 150,
  ...rest
} = Astro.props;
---

<div
  class={dropdownContent({ side, align, class: className })}
  role="menu"
  data-side={side}
  data-align={align}
  data-state="closed"
  tabindex="-1"
  aria-orientation="vertical"
  style={{
    display: "none",
    animationDuration: `${animationDuration}ms`,
    marginTop: side === "bottom" ? `${sideOffset}px` : undefined,
    marginBottom: side === "top" ? `${sideOffset}px` : undefined,
    marginLeft: side === "right" ? `${sideOffset}px` : undefined,
    marginRight: side === "left" ? `${sideOffset}px` : undefined,
  }}
  {...rest}
  data-slot="dropdown-content"
>
  <slot />
</div>
